name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    name: Code Quality (SwiftLint)
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install SwiftLint
        run: |
          # Check if SwiftLint is already installed
          if ! command -v swiftlint &> /dev/null; then
            echo "SwiftLint not found, installing via Homebrew..."
            brew install swiftlint
          else
            echo "SwiftLint is already installed"
            swiftlint version
          fi
      
      - name: Run SwiftLint
        run: |
          echo "Running SwiftLint with strict mode..."
          # Use --strict to fail on warnings, --reporter xcode for detailed output
          swiftlint lint --strict --reporter xcode
        continue-on-error: false
      
      - name: SwiftLint Summary
        if: always()
        run: |
          echo "SwiftLint execution completed"
          if [ $? -eq 0 ]; then
            echo "✅ No SwiftLint violations found"
          else
            echo "❌ SwiftLint violations detected - check output above for details"
          fi

  # Swift environment setup and build preparation
  setup:
    name: Swift Environment Setup
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Swift
        uses: swift-actions/setup-swift@v1
        with:
          swift-version: 'latest'
      
      - name: Verify Swift installation
        run: |
          echo "Swift version information:"
          swift --version
          echo ""
          echo "Swift Package Manager version:"
          swift package --version
          echo ""
          echo "Xcode version information:"
          xcodebuild -version
          echo ""
          echo "macOS version information:"
          sw_vers
      
      - name: Swift environment setup complete
        run: |
          echo "✅ Swift environment configured successfully"
          echo "- Swift version: $(swift --version | head -n1)"
          echo "- macOS runner: $(sw_vers -productName) $(sw_vers -productVersion)"
          echo "- Xcode version: $(xcodebuild -version | head -n1)"